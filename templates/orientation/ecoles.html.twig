{% extends 'base.html.twig' %}

{% block title %}Recherche d'Écoles - Orientation{% endblock %}

{% block body %}
<div class="container py-4">
    <h2 class="h3 mb-4">
        <i class="bi bi-building me-2"></i>Recherche d'Écoles
    </h2>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="get" action="{{ path('app_orientation_ecoles') }}">
                <div class="row g-3">
                    <div class="col-md-3">
                        <input type="text" class="form-control" name="search" placeholder="Nom de l'école..." value="{{ filters.search ?? '' }}">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="type">
                            <option value="">Tous les types</option>
                            <option value="public" {% if filters.type == 'public' %}selected{% endif %}>Public</option>
                            <option value="prive" {% if filters.type == 'prive' %}selected{% endif %}>Privé</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" name="ville" placeholder="Ville..." value="{{ filters.ville ?? '' }}">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search me-1"></i>Rechercher
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row g-4">
        {% for ecole in ecoles %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title h6 mb-0">{{ ecole.nom }}</h5>
                            {% if ecole.estVerifiee %}
                                <i class="bi bi-patch-check-fill text-primary" title="École vérifiée"></i>
                            {% endif %}
                        </div>

                        <p class="text-muted small mb-3">
                            <i class="bi bi-geo-alt me-1"></i>{{ ecole.ville }}, {{ ecole.region }}
                        </p>

                        <div class="mb-3">
                            <span class="badge bg-{{ ecole.type == 'public' ? 'success' : 'info' }} mb-2">
                                {{ ecole.type|upper }}
                            </span>
                        </div>

                        {% if ecole.presentation %}
                            <p class="card-text small text-muted">
                                {{ ecole.presentation|slice(0, 120) }}...
                            </p>
                        {% endif %}

                        <div class="mt-3">
                            <div class="small mb-2">
                                <i class="bi bi-book me-1"></i>
                                <strong>{{ ecole.filieres|length }}</strong> filière(s)
                            </div>
                            {% if ecole.tauxInsertion %}
                                <div class="small mb-2">
                                    <i class="bi bi-briefcase me-1"></i>
                                    Taux d'insertion: <strong>{{ ecole.tauxInsertion }}%</strong>
                                </div>
                            {% endif %}
                        </div>

                        <a href="{{ path('app_orientation_ecole_detail', {id: ecole.id}) }}" class="btn btn-outline-primary btn-sm w-100 mt-3">
                            <i class="bi bi-eye me-1"></i>Voir les détails
                        </a>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>Aucune école ne correspond à vos critères de recherche.
                </div>
            </div>
        {% endfor %}
    </div>

    {% if nbrPages > 1 %}
        {% include 'components/pagination.html.twig' with {
            'nbrPages': nbrPages,
            'currentPage': currentPage,
            'pathname': 'app_orientation_ecoles',
            'extraParams': filters
        } %}
    {% endif %}
</div>
{% endblock %}
