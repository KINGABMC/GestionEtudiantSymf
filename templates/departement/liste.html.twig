{% extends 'base.html.twig' %}
{% block body %}
<div class="container py-4">
  <!-- En-tête avec titre et formulaire de création -->
  <div class="row mb-4">
    <div class="col-md-6">
      <h1 class="h3 mb-3">Liste des Départements</h1>
      
      <!-- Formulaire de création de département -->
      <div class="card">
        <div class="card-body">
          {% include 'components/messageflash.html.twig' with {'messages': app.flashes()} %}  
          <h6 class="card-title mb-3">Nouveau Département</h6>
          {{ form_start(formDept, {'attr': {'data-turbo': 'false'}}) }}
          <div class="row g-3 align-items-end">
            <div class="col-md-8">
              {# Champ avec gestion d'erreur #}
              {{ form_label(formDept.name, null, {'label_attr': {'class': 'form-label'}}) }}
              {{ form_widget(formDept.name, {
                'attr': {
                  'class': 'form-control ' ~ (formDept.name.vars.errors|length > 0 ? 'is-invalid' : ''),
                  'placeholder': 'Nom du département...'
                }
              }) }}
              {# Affichage des erreurs #}
              <div class="invalid-feedback">
                {{ form_errors(formDept.name) }}
              </div>
            </div>
            <div class="col-md-4">
              {{ form_widget(formDept.submit, {
                'attr': {
                  'class': 'btn btn-success w-100'
                }
              }) }}
            </div>
          </div>
          {{ form_end(formDept) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Le reste de votre template reste inchangé -->
  <!-- Tableau des départements -->
  <div class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0" id="departmentsTable">
          <thead class="table-light">
            <tr>
              <th scope="col" class="border-0">ID</th>
              <th scope="col" class="border-0">Name</th>
              <th scope="col" class="border-0">Date Creation</th>
              <th scope="col" class="border-0">Nombre d'Employé</th>
              <th scope="col" class="border-0">Statut</th>
              <th scope="col" class="border-0 text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for departement in departements %}
            <tr>
              <td>{{ departement.id }}</td>
              <td>{{ departement.name }}</td>
              <td>{{ departement.createAt|date('d/m/Y') }}</td>
              <td><span class="badge bg-primary">{{ departement.nbrEmployes }}</span></td>
              <td>
                <span class="badge bg-info" style="font-size: 10px;">
                  {{ departement.isArchived ? 'Archivé' : 'Actif' }}
                </span>
              </td>
              <td class="align-middle text-center">
                <div class="btn-group" role="group">
                  <a href="{{ path('app_employe_by_departement', {'id': departement.id}) }}" 
                     type="button" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-eye me-1"></i>Employés
                  </a>
                  <a href="#" type="button" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-pencil-alt me-1"></i>Éditer
                  </a>
                  <a href="#" type="button" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-trash me-1"></i>Archiver
                  </a>
                </div>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6">
                <div class="alert alert-danger text-center" role="alert">
                  Aucun département trouvé.
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-4">
    {% include 'components/pagination.html.twig' with {
      'nbrPages': nbrPages,
      'currentPage': currentPage,
      'pathname': 'app_departement_list'
    } %}
  </div>
</div>
{% endblock %}